<?php

$main_char = array(
    "।"    =>    "|", 	"‘"    =>    "Ô", 	"’"    =>    "Õ", 
	"“"    =>    "Ò", 	"”"    =>    "Ó", 	"্র্য"    =>    "ª¨", 
	"ম্প্র"    =>    "¤cÖ", 	"র‌্য"    =>    "i¨", 	"ক্ষ্ম"    =>    "²", 
	"ক্ক"    =>    "°", 	"ক্ট"    =>    "±", 	"ক্ত"    =>    "³", 
	"ক্ব"    =>    "K¡", 	"স্ক্র"    =>    "¯Œ", 	"ক্র"    =>    "µ", 
	"ক্ল"    =>    "K¬", 	"ক্ষ"    =>    "¶", 	"ক্স"    =>    "·", 
	"গু"    =>    "¸", 	"গ্ধ"    =>    "»", 	"গ্ন"    =>    "Mœ", 
	"গ্ম"    =>    "M¥", 	"গ্ল"    =>    "M­", 	"গ্রু"    =>    "Mªy", 
	"ঙ্ক"    =>    "¼", 	"ঙ্ক্ষ"    =>    "•¶", 	"ঙ্খ"    =>    "•L", 
	"ঙ্গ"    =>    "½", 	"ঙ্ঘ"    =>    "•N", 	"চ্ছ্ব"    =>    "”Q¡", 
	"চ্চ"    =>    "”P", 	"চ্ছ"    =>    "”Q", 	"চ্ঞ"    =>    "”T", 
	"জ্জ্ব"    =>    "¾¡", 	"জ্জ"    =>    "¾", 	"জ্ঝ"    =>    "À", 
	"জ্ঞ"    =>    "Á", 	"জ্ব"    =>    "R¡", 	"ঞ্চ"    =>    "Â", 
	"ঞ্ছ"    =>    "Ã", 	"ঞ্জ"    =>    "Ä", 	"ঞ্ঝ"    =>    "Å", 
	"ট্ট"    =>    "Æ", 	"ট্ব"    =>    "U¡", 	"ট্ম"    =>    "U¥", 
	"ড্ড"    =>    "Ç", 	"ণ্ট"    =>    "È", 	"ণ্ঠ"    =>    "É", 
	"ন্স"    =>    "Ý", 	"ণ্ড"    =>    "Ê", 	"ন্তু"    =>    "š‘", 
	"ণ্ব"    =>    "Y^", 	"ত্ত্ব"    =>    "Ë¡", 	"ত্ত"    =>    "Ë", 
	"ত্থ"    =>    "Ì", 	"ত্ন"    =>    "Zœ", 	"ত্ম"    =>    "Z¥", 
	"ন্ত্ব"    =>    "š—¡", 	"ত্ব"    =>    "Z¡", 	"থ্ব"    =>    "_¡", 
	"দ্গ"    =>    "˜M", 	"দ্ঘ"    =>    "˜N", 	"দ্দ"    =>    "Ï", 
	"দ্ধ"    =>    "×", 	"দ্ব"    =>    "˜¡", 	"দ্ব"    =>    "Ø", 
	"দ্ভ"    =>    "™¢", 	"দ্ম"    =>    "Ù", 	"দ্রু"    =>    "`ª“", 
	"ধ্ব"    =>    "aŸ", 	"ধ্ম"    =>    "a¥", 	"ন্ট"    =>    "›U", 
	"ন্ঠ"    =>    "Ú", 	"ন্ড"    =>    "Û", 	"ন্ত্র"    =>    "š¿", 
	"ন্ত"    =>    "š—", 	"স্ত্র"    =>    "¯¿", 	"ত্র"    =>    "Î", 
	"ন্থ"    =>    "š’", 	"ন্দ"    =>    "›`", 	"ন্দ্ব"    =>    "›Ø", 
	"ন্ধ"    =>    "Ü", 	"ন্ন"    =>    "bœ", 	"ন্ব"    =>    "š^", 
	"ন্ম"    =>    "b¥", 	"প্ট"    =>    "Þ", 	"প্ত"    =>    "ß", 
	"প্ন"    =>    "cœ", 	"প্প"    =>    "à", 	"প্ল"    =>    "c­", 
	"প্স"    =>    "á", 	"ফ্ল"    =>    "d¬", 	"ব্জ"    =>    "â", 
	"ব্দ"    =>    "ã", 	"ব্ধ"    =>    "ä", 	"ব্ব"    =>    "eŸ", 
	"ব্ল"    =>    "e­", 	"ভ্র"    =>    "å", 	"ম্ন"    =>    "gœ", 
	"ম্প"    =>    "¤ú", 	"ম্ফ"    =>    "ç", 	"ম্ব"    =>    "¤^", 
	"ম্ভ"    =>    "¤¢", 	"ম্ভ্র"    =>    "¤£", 	"ম্ম"    =>    "¤§", 
	"ম্ল"    =>    "¤­", 	"্র"    =>    "ª", 	"রু"    =>    "i“", 
	"রূ"    =>    "iƒ", 	"ল্ক"    =>    "é", 	"ল্গ"    =>    "ê", 
	"ল্ট"    =>    "ë", 	"ল্ড"    =>    "ì", 	"ল্প"    =>    "í", 
	"ল্ফ"    =>    "î", 	"ল্ব"    =>    "j¦", 	"ল্ম"    =>    "j¥", 
	"ল্ল"    =>    "j­", 	"শু"    =>    "ï", 	"শ্চ"    =>    "ð", 
	"শ্ন"    =>    "kœ", 	"শ্ব"    =>    "k¦", 	"শ্ম"    =>    "k¥", 
	"শ্ল"    =>    "k­", 	"ষ্ক"    =>    "®‹", 	"ষ্ক্র"    =>    "®Œ", 
	"ষ্ট"    =>    "ó", 	"ষ্ঠ"    =>    "ô", 	"ষ্ণ"    =>    "ò", 
	"ষ্প"    =>    "®ú", 	"ষ্ফ"    =>    "õ", 	"ষ্ম"    =>    "®§", 
	"স্ক"    =>    "¯‹", 	"স্ট"    =>    "÷", 	"স্খ"    =>    "ö", 
	"স্ত"    =>    "¯—", 	"স্তু"    =>    "¯‘", 	"স্থ"    =>    "¯’", 
	"স্ন"    =>    "mœ", 	"স্প"    =>    "¯ú", 	"স্ফ"    =>    "ù", 
	"স্ব"    =>    "¯^", 	"স্ম"    =>    "¯§", 	"স্ল"    =>    "¯­", 
	"হু"    =>    "û", 	"হ্ণ"    =>    "nè", 	"হ্ব"    =>    "nŸ", 
	"হ্ন"    =>    "ý", 	"হ্ম"    =>    "þ", 	"হ্ল"    =>    "n¬", 
	"হৃ"    =>    "ü", 	"র্"    =>    "©", 	"্র"    =>    "«", 
	"্য"    =>    "¨", 	"্"    =>    "&", 	"আ"    =>    "Av", 
	"অ"    =>    "A", 	"ই"    =>    "B", 	"ঈ"    =>    "C", 
	"উ"    =>    "D", 	"ঊ"    =>    "E", 	"ঋ"    =>    "F", 
	"এ"    =>    "G", 	"ঐ"    =>    "H", 	"ও"    =>    "I", 
	"ঔ"    =>    "J", 	"ক"    =>    "K", 	"খ"    =>    "L", 
	"গ"    =>    "M", 	"ঘ"    =>    "N", 	"ঙ"    =>    "O", 
	"চ"    =>    "P", 	"ছ"    =>    "Q", 	"জ"    =>    "R", 
	"ঝ"    =>    "S", 	"ঞ"    =>    "T", 	"ট"    =>    "U", 
	"ঠ"    =>    "V", 	"ড"    =>    "W", 	"ঢ"    =>    "X", 
	"ণ"    =>    "Y", 	"ত"    =>    "Z", 	"থ"    =>    "_", 
	"দ"    =>    "`", 	"ধ"    =>    "a", 	"ন"    =>    "b", 
	"প"    =>    "c", 	"ফ"    =>    "d", 	"ব"    =>    "e", 
	"ভ"    =>    "f", 	"ম"    =>    "g", 	"য"    =>    "h", 
	"র"    =>    "i", 	"ল"    =>    "j", 	"শ"    =>    "k", 
	"ষ"    =>    "l", 	"স"    =>    "m", 	"হ"    =>    "n", 
	"ড়"    =>    "o", 	"ঢ়"    =>    "p", 	"য়"    =>    "q", 
	"ৎ"    =>    "r", 	"০"    =>    "0", 	"১"    =>    "1", 
	"২"    =>    "2", 	"৩"    =>    "3", 	"৪"    =>    "4", 
	"৫"    =>    "5", 	"৬"    =>    "6", 	"৭"    =>    "7", 
	"৮"    =>    "8", 	"৯"    =>    "9", 	"া"    =>    "v", 
	"ি"    =>    "w", 	"ী"    =>    "x", 	"ু"    =>    "y", 
	"ূ"    =>    "~", 	"ৃ"    =>    "…", 	"ে"    =>    "‡", 
	"ৈ"    =>    "‰", 	"ৗ"    =>    "Š", 	"ং"    =>    "s", 
	"ঃ"    =>    "t", 	"ঁ"    =>    "u"
);

function IsBanglaPreKar($c) {
    if ($c == 'ি' || $c == 'ৈ' || $c == 'ে')
        return true;
    return false;
}

function IsBanglaPostKar($c) {
    if ($c == 'া' || $c == 'ো' || $c == 'ৌ' || $c == 'ৗ' || $c == 'ু' || $c == 'ূ' || $c == 'ী' || $c == 'ৃ')
        return true;
    return false;
}

function IsBanglaKar($c) {
    if (IsBanglaPreKar($c) || IsBanglaPostKar($c))
        return true;
    return false;
}

function IsBanglaBanjonborno($c) {
    if ($c == 'ক' || $c == 'খ' || $c == 'গ' || $c == 'ঘ' || $c == 'ঙ' || $c == 'চ' || $c == 'ছ' || $c == 'জ' || $c == 'ঝ' || $c == 'ঞ' || $c == 'ট' || $c == 'ঠ' || $c == 'ড' || $c == 'ঢ' || $c == 'ণ' || $c == 'ত' || $c == 'থ' || $c == 'দ' || $c == 'ধ' || $c == 'ন' || $c == 'প' || $c == 'ফ' || $c == 'ব' || $c == 'ভ' || $c == 'ম' || $c == 'য' || $c == 'র' || $c == 'ল' || $c == 'শ' || $c == 'ষ' || $c == 'স' || $c == 'হ' || $c == 'ড়' || $c == 'ঢ়' || $c == 'য়' || $c == 'ৎ' || $c == 'ং' || $c == 'ঃ' || $c == 'ঁ')
        return true;
    return false;
}

function IsBanglaSoroborno($c) {
    if ($c == 'অ' || $c == 'আ' || $c == 'ই' || $c == 'ঈ' || $c == 'উ' || $c == 'ঊ' || $c == 'ঋ' || $c == 'ঌ' || $c == 'এ' || $c == 'ঐ' || $c == 'ও' || $c == 'ঔ')
        return true;
    return false;
}

function IsBanglaNukta($c) {
    if ($c == 'ঁ')
        return true;
    return false;
}

function IsBanglaHalant($c) {
    if ($c == '্')
        return true;
    return false;
}

function reArrangeUnicodeText($str) {
	global $main_char ;
    $cY=0;
    for ($i = 0; $i < mb_strlen($str); ++$i) {
        if($i<mb_strlen($str)&&IsBanglaPreKar(mbCharAt($str,$i))) {
            $j=1;
            while(IsBanglaBanjonborno(mbCharAt($str,$i-$j))) {
                if($i-$j<0)break;
                if($i-$j<=$cY)break;
                if(IsBanglaHalant(mbCharAt($str,$i-$j-1)))$j+=2;
                else break;
            }
            $R	= subString($str,0, $i-$j);
            $R .= mbCharAt($str,$i);
            $R .= subString($str,$i-$j, $i);
            $R .= subString($str,$i+1, mb_strlen($str));
            
			$str = $R;
			
            $cY= $i+1;
            continue;
        }
		
        if($i<mb_strlen($str)-1&&IsBanglaHalant(mbCharAt($str,$i))&&mbCharAt($str,$i-1)=='র'&& !IsBanglaHalant(mbCharAt($str,$i-2))) {
            $j=1;
            $aZ=0;
            while(true) {
                if(IsBanglaBanjonborno(mbCharAt($str,$i+$j))&&IsBanglaHalant(mbCharAt($str,$i+$j+1)))$j+=2;
                else if(IsBanglaBanjonborno(mbCharAt($str,$i+$j))&&IsBanglaPreKar(mbCharAt($str,$i+$j+1))) {
                    $aZ=1;
                    break;
                }
                else break;
            }
            $R  = subString($str,0, $i-1);
            $R .= subString($str,$i+$j+1, $i+$j+$aZ+1);
            $R .= subString($str,$i+1, $i+$j+1);
            $R .= mbCharAt($str,$i-1);
            $R .= mbCharAt($str,$i);
            $R .= subString($str,$i+$j+$aZ+1, mb_strlen($str));
            
			$str = $R;
            
			$i+=($j+$aZ);
            $cY=$i+1;
            continue;
        }
    }
    return $str;	
}

function u2b($srcString){
	global $preConversionMap, $main_char, $postConversionMap;
	
	$pattern = 'ো';
	$replacement = 'ো';
	$srcString = str_replace($pattern, $replacement, $srcString);

	$pattern = 'ৌ';
	$replacement = 'ৌ';
	$srcString = str_replace($pattern, $replacement, $srcString);

	
	$srcString = reArrangeUnicodeText($srcString);

	foreach ($main_char as $key => $value) {
		$pattern = $key;
		$replacement = $value;
		$srcString = str_replace($pattern, $replacement, $srcString);
	}

	return $srcString;
	
}

//returns the $i-th byte of the multi-byte string $str
function mbCharAt($str, $i) {
    return mb_substr($str, $i, 1);
}

//returns the javascript 'substring' method equivalent
function subString($string, $from, $to) {
    return mb_substr($string, $from, $to - $from);
}

